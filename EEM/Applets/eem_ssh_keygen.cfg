event manager applet EEM_SSH_Keygen authorization bypass
 event syslog pattern "SYS-5-RESTART"
 action 0.1 set status "None"
 action 1.0 cli command "enable"
 action 2.0 cli command "show ip ssh | include ^SSH"
 action 2.1 comment result is total regexp match, status is subgroup1 or what's in the parenthesis
 action 2.2 regexp "^SSH ([ED][a-z]+)" "$_cli_result" result status
 action 2.3 syslog priority informational msg "SSH is currently $status"
 action 3.0 if $status eq "Disabled"
 action 3.1  cli command "configure terminal"
 action 3.2  cli command "crypto key generate rsa modulus 1024"
 action 3.3  cli command "end"
 action 3.4  syslog priority informational msg "SSH keys generated by EEM Applet"
 action 3.5  comment "write mem" will fail if their is a confirmation prompt (some cases) - so put it last
 action 3.6  cli command "write mem"
 action 3.7 end

